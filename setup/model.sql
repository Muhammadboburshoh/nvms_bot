-- create admins(
--     id
--     login
--     password
-- )
-- schools(
--     id
--     name
--     login
--     password
-- )
-- parents(
--     id
--     phone
--     telegram_id
--     password
-- )

--oxirigacha yitkizish kerak
create table attendance(
    id int generated by default as identity primary key,
    name
)
attendance (
    id
    name
    file
    school_id
)

create database nvms; \c nvms

create table admins(
    id int generated by default as identity primary key,
    role smallint not null default 0,
    login varchar(40) not null,
    password varchar(64) not null,
    school varchar(40) not null
);
create unique index username_index on admins(lower(username));

create table schools(
    id int generated by default as identity primary key,
    name varchar(100) not null,
    login varchar(40) not null,
    password varchar(64) not null
);
create unique index login_index on schools(lower(login));

create table parents(
    id int generated by default as identity primary key,
    phone varchar(20) not null,
    password varchar(64) not null,
    telegram_id int,
    step smallint not null default 0,
    school_id int not null references schools(id)
);
create unique index phone_index on parents(phone);

create extension pgcrypto;

insert into admins (username, password, role, school) values ('admin', crypt('1234', gen_salt('bf')), 1, 118);
insert into schools (name, login, password) values ('118-maktab', "118", crypt('111', gen_salt('bf')));

---------------------------------
--new database version

create database nvms_d;
\c nvms_d

create table admins(
    id int generated by default as identity primary key,
    role smallint not null default 0,
    login varchar(40) not null,
    password varchar(64) not null,
    school varchar(40) not null
);
create unique index admin_index on admins(lower(login));

create table schools(
    id int generated by default as identity primary key,
    name varchar(100) not null,
    login varchar(40) not null,
    password varchar(64) not null
);
create unique index school_index on schools(lower(login));

create table classes(
    id int generated by default as identity primary key,
    class varchar(10) not null,
    school_id int not null references schools(id)
);
create unique index class_index on classes(lower(class), school_id);

create table parents(
    id int generated by default as identity primary key,
    phone varchar(20) not null,
    password varchar(64) not null,
    telegram_id int,
    step smallint not null default 0,
    class_id int not null references classes(id)
);
create unique index phone_index on parents(phone);

--insert value
create extension pgcrypto;

insert into admins (role, login, password, school) values (1, 'admin', crypt('1234', gen_salt('bf')), 118);
insert into schools (name, login, password) values ('120-maktab', '120', crypt('2222', gen_salt('bf')));

